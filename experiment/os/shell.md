# shell

Author: [@Wanli Yang](https://github.com/wending0417)

日常常用的shell主要有最基本的`bash`和较新的`zsh`与`fish`

## bash

## zsh
`zsh`全名为Z-Shell，它与`bash`相比，能力更加强大并且更快。相较于`bash`，`zsh`现在社区更加活跃，是一个还在成长中的项目。具体来讲有这些优势:
+ 更优秀的命令行补全能力；
+ 配置化能力更强；
+ 更现代的语法；
+ 改进的错误报告；
+ 模拟`bash`；
+ 用户社区不断壮大，更新频繁；
+ 体验更好的按键;
+ 支持vi模式等
[点击这里](/experiment/os/zsh.md)查看如何在服务器上配置`zsh`。

## fish

## 常用shell 命令

### ">" 输出重定向

在服务器上做实验时，如果我们直接在命令行运行程序，那么程序的输出结果也会打印在屏幕上。

如果我们希望程序运行结束后更好地整理和查阅输出结果，可以使用输出重定向命令">"：`python xxx.py > yyy`，`yyy`代表输出目标文件的路径。该命令会将`xxx.py`程序的所有输出内容写入`yyy`文件，这样屏幕输出信息也不会很杂乱。若需要实时查看程序运行进度，打开`yyy`文件即可。

（注：虽然使用输出重定向之后，屏幕上不会输出内容，但是**程序还是占用当前的命令行**的，程序运行结束前无法用命令行执行其他任务）

###  "&" 程序后台运行

大家刚用服务器跑实验的时候可能会直接在命令行运行程序（`python xxx.py`） ，这样可能遇到的第一个问题是：程序运行时间很长，长时间占用命令行，导致无法进行其他工作。

这时候第一个解决方案是`&`命令，只需要在命令末尾加上`&`，如`python xxx.py &`程序就会放到后台执行，不占用当前命令行。但是程序的输出信息还会打印在当前屏幕上，所以建议大家将`&`和`>`搭配使用，比如`python xxx.py > yyy &`，这样的话，当前程序不会占用命令行，同时输出信息也会写入到指定的`yyy`文件。大家就可以愉快地开始下一项任务。

### nohup

`&`搭配`>`并不是那么完美。我们在做实验的时候还可能遇到**终端断联（可能是网络不好、可能是我们下班想关闭终端）等因素导致实验中断**，`nohup`命令是一个常用的办法。

`nohup` 英文全称 no hang up（不挂起），用于在系统后台不挂断地运行命令，**简单来说就是退出终端不会影响程序的运行**。指令形如`nohup python xxx.py &`（注：`nohup`通常搭配`&`使用，如果单独使用`nohup`而不使用`&`，程序仍然会占据当前命令行）

`nohup` 命令在默认情况下，会输出一个名叫 nohup.out 的文件到当前目录下。因此我们通常还会加上重定向指令，将内容输出到指定文件：`nohup python xxx.py > yyy &`。

当`nohup`、`&`、`>`三板斧搭配使用时，我们就可以做到将程序输出定向到特定文件、程序在后台执行不占用当前命令行、即使关闭终端也不会影响程序执行。

### 将正在运行的前台任务转入后台

有时候我们不知道一个任务会运行多久，所以我们可能直接在前台运行了该任务，但是过了一段时间发现该任务短时间内无法结束，我们又不希望杀死该进程重新在后台执行任务；又或者我们的程序在前期会有一些交互（需要外部输入一些信息）才开始长时间运行。这些情况共同指向了一个需求——将前台运行任务转入后台同时。

前台运行程序：`python xxx.py`（开始持续输出/交互）

输入`ctrl + z` 将该前台任务挂起/暂停（命令行输出`[1]+  Stopped     python xxx.py`）

运行`jobs`命令，查看该任务号（命令行输出`[1]+  Stopped       python xxx.py`）

运行`bg`命令（`bg %[任务号]`)，将任务从前台转到后台

输入`disown -h %[任务号]`来使该作业忽略HUP信号（也就是nohup的效果）

### 将正在运行的后台任务转入前台

既然任务可以从前台转后台，那反过来从后台转前台是否可行呢？答案是可以的

例如通过`nohup python xxx.py > yyy &`运行程序

输入`jobs`查看任务号

再通过`fg %[任务号]` 将程序放到前台执行

（相当于执行`nohup python xxx.py > yyy`的效果）

### `nvidia-smi`查看服务器当前显存占用

只需要执行`nvidia-smi`命令就可以查看当前的服务器显存占用了

不过更推荐使用`nvitop`（第三方库）
